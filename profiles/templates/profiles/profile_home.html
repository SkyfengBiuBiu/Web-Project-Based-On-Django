{% extends 'profiles/profile_base.html' %}

{% load static %}

{% block right %}
    <!-- Posts List start -->
    <div class="col-md-6 change-gutters">
        <!-- Post Form start -->
        <div id="id_post_create_div"></div>

        <!-- Post Form end -->
        <div id="id_post_list">
            {% include 'profiles/post/post_list.html' %}
        </div>
    </div>
    <!-- Posts List end -->

    <div class="col-md-3 change-gutters">
        <!-- Discussions List start -->
        <div class="card post-card">
            <div class="card-header">
                <h5 class="card-title">Discussions List</h5>
            </div>
            <ul class="list-group list-group-flush">
                {% for discussion in discussion_list %}
                    <li class="list-group-item">
                    </li>
                {% endfor %}
            </ul>
            <div class="card-footer">
                <a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>
                <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
                <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
            </div>
        </div>
        <!-- Discussions List end -->

        <!-- Friends List start -->
        <div class="card post-card">
            <div class="card-header">
                <h5 class="card-title">Friends List</h5>
            </div>
            <ul class="list-group list-group-flush">
                {% for friend in friend_list %}
                    <li class="list-group-item">
                        <a href="{% url 'profiles:visit_home' friend.id %}">
                            <img class="rounded-circle" width="20" src="https://picsum.photos/50/50"
                                 alt="{{ friend.username }}'s Profile Photo">
                            <span>{{ friend.username }}</span>
                        </a>
                    </li>
                {% endfor %}
            </ul>
            <div class="card-footer">
                <a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>
                <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
                <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
            </div>
        </div>
        <!-- Friends List end -->

        <!-- Events List start -->
        <div class="card post-card">
            <div class="card-header">
                <h5 class="card-title">Events List</h5>
            </div>
            <ul class="list-group list-group-flush">
                {% for event in event_list %}
                    <li class="list-group-item">
                    </li>
                {% endfor %}
            </ul>
            <div class="card-footer">
                <a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>
                <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
                <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
            </div>
        </div>
        <!-- Events List end -->
    </div>

    <!-- Message Notifications -->
    <div id="id_ajax_notification" class="modal fade bottom" id="frameModalBottom" tabindex="-1" role="dialog"
         aria-labelledby="ajax_notification"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <div class="row d-flex justify-content-center align-items-center">
                        <p id="id_ajax_notification_body" class="pt-3 pr-2"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js-extra-script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $("#id_post_create_div").load(
                "{% url 'profiles:post_create' %}",
                refreshForms
            );
            refreshPosts();
        });

        function refreshForms() {
            $("form").on("submit", function (event) {
                event.preventDefault();
                $.ajax({
                    data: $(this).serialize(),
                    type: $(this).attr('method'),
                    url: $(this).attr('action'),
                    success: function (response) {
                        console.log(response)
                        $("#id_post_create_div").load("{% url 'profiles:post_create' %}", refreshForms); // reset form
                        $("#id_post_list").load("{% url 'profiles:post_list' user.id 1 %}", refreshPosts); // refresh posts list
                        $("#id_ajax_notification_body").html(response.message);
                        // message notification
                        $("#id_ajax_notification").modal('toggle');
                    },
                    error: function (data) {
                        $("#id_ajax_notification_body").html('Please wait for a moment...');
                        // message notification
                        $("#id_ajax_notification").modal('toggle');
                    }
                });
            });
        }

        function refreshPosts() {
            $(".pagination a.page-link").on('click', function (event) {
                event.preventDefault();
                $("#id_post_list").load($(this).attr('href'), refreshPosts); // refresh posts list
            });
        }
    </script>
{% endblock %}